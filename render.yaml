services:
  - type: web
    name: chatwoot
    env: docker
    repo: https://github.com/chatwoot/chatwoot
    plan: free # Ensure this plan supports your services
    dockerContext: .
    dockerfilePath: Dockerfile
    envVars:
      - key: RAILS_ENV
        value: production
      - key: SECRET_KEY_BASE
        generateValue: true
      - key: FRONTEND_URL
        # IMPORTANT: Update this to your actual Render service URL after deployment
        # e.g., https://your-chatwoot-app-name.onrender.com
        value: https://chatwoot.onrender.com # Placeholder, update as needed
      - key: POSTGRES_HOST
        value: ${chatwoot-postgres-db.host}
      - key: POSTGRES_DB
        value: ${chatwoot-postgres-db.database} # Refers to 'databaseName' in the databases block
      - key: POSTGRES_USER
        value: ${chatwoot-postgres-db.user}     # Refers to 'user' in the databases block
      - key: POSTGRES_PASSWORD
        value: ${chatwoot-postgres-db.password} # The auto-generated password
      - key: REDIS_URL
        fromService: # fromService is correct for referencing other services like Redis
          type: redis
          name: chatwoot-redis
          property: connectionString

  - type: redis # Redis is correctly defined as a service
    name: chatwoot-redis
    plan: free # Ensure this plan is available
    ipAllowList: [] # Allows access from other services in your Render account
    # redisVersion: 7 # Optional: Specify Redis version (e.g., 6, 7). Defaults to 7.

databases:
  - name: chatwoot-postgres-db # This is the 'dbName' used in ${...} references
    plan: free # Ensure this plan is available for databases
    databaseName: chatwoot     # Value for ${chatwoot-postgres-db.database}
    user: chatwoot             # Value for ${chatwoot-postgres-db.user}
    # postgresMajorVersion: 14 # Optional: Specify PostgreSQL version. Defaults to 14.
